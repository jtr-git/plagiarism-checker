This was indeed a nice programming problem 
